# Springboard Package Consolidation Strategy

## Executive Summary

This document provides a comprehensive analysis of the current Springboard package structure and proposes a consolidation strategy to simplify the architecture. Currently, Springboard is split across 14+ published packages with complex interdependencies. This analysis recommends consolidating into a single core package with optional peer dependency groups based on the patterns used by frameworks like Nitro.js, h3, and Hono.

---

## Part 1: Current Structure Analysis

### 1.1 Current Package Overview

The Springboard framework currently consists of the following published packages:

#### Core Packages (Essential)
1. **springboard** (main core)
   - Location: `packages/springboard/core/`
   - Version: 0.0.1-autogenerated
   - Exports: Default export from engine/register
   - Size: ~1.3KB package.json
   - Main entry: `./src/index.ts`
   - Module entry: `./src/index.ts` (ES module)

2. **@springboardjs/data-storage**
   - Location: `packages/springboard/data_storage/`
   - Version: 0.0.1-autogenerated
   - Dependencies: better-sqlite3, zod
   - Peer Dependencies: kysely (>=0.24.0)
   - Size: ~400B package.json
   - Exports: KV API implementations (SQL/Kysely)

3. **springboard-server**
   - Location: `packages/springboard/server/`
   - Version: 0.0.1-autogenerated
   - Dependencies: @hono/node-server, @hono/node-ws, json-rpc-2.0, hono
   - Peer Dependencies: @springboardjs/data-storage, @springboardjs/platforms-node, springboard
   - Size: ~900B package.json
   - Main entry: `./index.ts`

#### Platform Adapters (5 packages)
4. **@springboardjs/platforms-node**
   - Location: `packages/springboard/platforms/node/`
   - Peer Dependencies: isomorphic-ws, springboard, ws
   - Dependencies: json-rpc-2.0, reconnecting-websocket
   - Architecture: No index files - service-based structure

5. **@springboardjs/platforms-browser** (web/webapp)
   - Location: `packages/springboard/platforms/webapp/`
   - Peer Dependencies: react-router@^7, springboard
   - Dependencies: json-rpc-2.0, reconnecting-websocket
   - Architecture: Service-based

6. **@springboardjs/platforms-tauri**
   - Location: `packages/springboard/platforms/tauri/`
   - Dependencies: @springboardjs/platforms-browser, @springboardjs/platforms-node, @tauri-apps/api, @tauri-apps/plugin-shell
   - Peer Dependencies: springboard
   - Architecture: Composite adapter (depends on both browser and node)

7. **@springboardjs/platforms-partykit**
   - Location: `packages/springboard/platforms/partykit/`
   - Dependencies: @springboardjs/platforms-browser, @springboardjs/platforms-node, hono, json-rpc-2.0, partysocket, springboard-server, zod
   - Peer Dependencies: springboard
   - Architecture: Composite, includes server integration

8. **@springboardjs/platforms-react-native**
   - Location: `packages/springboard/platforms/react-native/`
   - Peer Dependencies: @springboardjs/platforms-browser, springboard
   - Dependencies: json-rpc-2.0, reconnecting-websocket
   - Main entry: `./src/index.ts`

#### Plugin & Extension Packages (3+ packages)
9. **@springboardjs/plugin-svelte**
   - Location: `packages/springboard/plugins/svelte/`
   - Dependencies: esbuild-svelte, svelte-preprocess
   - Peer Dependencies: react, react-dom, rxjs, springboard, svelte (>=5)
   - Build command: Custom tsx script with esbuild-svelte

10. **@springboardjs/mantine** (external integrations)
    - Location: `packages/springboard/external/mantine/`
    - Peer Dependencies: @mantine/core, @mantine/dropzone, @mantine/hooks, @mantine/modals, @mantine/notifications, springboard
    - No dependencies (only peer)

11. **@springboardjs/shoelace** (external integrations)
    - Location: `packages/springboard/external/shoelace/`
    - Dependencies: @shoelace-style/shoelace
    - Peer Dependencies: @springboardjs/platforms-browser, springboard

#### CLI & Project Generation (2 packages)
12. **springboard-cli**
    - Location: `packages/springboard/cli/`
    - Peer Dependencies: @springboardjs/platforms-browser, @springboardjs/platforms-node, springboard, springboard-server
    - Dependencies: commander, concurrently, esbuild, tslib, typescript
    - Purpose: Build and dev server for Springboard apps
    - Entry point: `./src/cli.ts` compiled to `dist/cli.js` with node shebang

13. **create-springboard-app**
    - Location: `packages/springboard/create-springboard-app/`
    - Dependencies: commander, tslib, typescript
    - Purpose: Project scaffolding tool
    - Entry point: `dist/cli.js` with node shebang

#### Related Packages (not in springboard/ but interdependent)
14. **@jamtools/core**
    - Location: `packages/jamtools/core/`
    - Peer Dependencies: @springboardjs/platforms-browser, @tonejs/midi, springboard, svelte (optional)
    - Dependencies: easymidi, immer, midi-file, soundfont-player, webmidi

### 1.2 Total Package Count and Publishing

**Published to NPM:**
- 14+ packages total
- All published under different naming schemes:
  - `springboard` (main)
  - `springboard-*` (cli, server)
  - `@springboardjs/*` (scoped packages)
- Publishing sequence (see `scripts/run-all-folders.sh`):
  1. data_storage
  2. core
  3. platforms (webapp, node, react-native, partykit)
  4. server
  5. external (mantine, shoelace)
  6. jamtools packages
  7. cli
  8. create-springboard-app
  9. plugins

### 1.3 Dependency Graph

```
springboard (core)
├── (peer: immer, json-rpc-2.0, react, react-dom, rxjs)
├── (dependencies: dexie, reconnecting-websocket, ws)
│
├─ springboard-server
│  ├── (depends on: @hono/node-server, @hono/node-ws, json-rpc-2.0, hono)
│  ├── (peer: @springboardjs/data-storage, @springboardjs/platforms-node, springboard)
│  │
│  └─ @springboardjs/platforms-partykit
│     ├── (depends on: platforms-browser, platforms-node, hono, springboard-server, etc.)
│     └── (peer: springboard)
│
├─ @springboardjs/data-storage
│  ├── (depends on: better-sqlite3, zod)
│  └── (peer: kysely)
│
├─ @springboardjs/platforms-node
│  ├── (peer: isomorphic-ws, springboard, ws)
│  └── (dependencies: json-rpc-2.0, reconnecting-websocket)
│
├─ @springboardjs/platforms-browser (webapp)
│  ├── (peer: react-router, springboard)
│  └── (dependencies: json-rpc-2.0, reconnecting-websocket)
│
├─ @springboardjs/platforms-tauri
│  ├── (depends on: platforms-browser, platforms-node, @tauri-apps/api, @tauri-apps/plugin-shell)
│  └── (peer: springboard)
│
├─ @springboardjs/platforms-react-native
│  ├── (peer: platforms-browser, springboard)
│  └── (dependencies: json-rpc-2.0, reconnecting-websocket)
│
├─ @springboardjs/plugin-svelte
│  ├── (depends on: esbuild-svelte, svelte-preprocess)
│  └── (peer: react, react-dom, rxjs, springboard, svelte)
│
├─ @springboardjs/mantine
│  └── (peer: @mantine/*, springboard)
│
├─ @springboardjs/shoelace
│  ├── (depends on: @shoelace-style/shoelace)
│  └── (peer: platforms-browser, springboard)
│
└─ springboard-cli
   ├── (depends on: commander, esbuild, tslib, typescript)
   ├── (peer: platforms-browser, platforms-node, springboard, springboard-server)
   └── (all platforms as peer dependencies)
```

### 1.4 Version Management

**Current Strategy:**
- All packages use `"version": "0.0.1-autogenerated"` in source
- Publishing script bumps all to same version (currently 0.15.0-rc9)
- Monorepo tool: `pnpm` with workspace: protocol
- Versioning scheme: semantic with optional pre-release tags (-rc, -dev, -alpha)
- Tag strategy: latest, rc, or dev based on version format

**Release Process:**
```bash
./scripts/run-all-folders.sh v0.15.0-rc9 --mode npm
```
- Bumps all packages to identical versions
- Publishes in dependency order with 1-second delays
- Uses `pnpm publish --access public --tag <tag> --no-git-checks`

### 1.5 Current Issues & Complexity

1. **Fragmentation**: 14+ packages means:
   - Complex dependency management
   - Version coordination required for all
   - Difficult onboarding/discovery
   - Npm registry pollution

2. **Peer Dependencies Problem**:
   - Many packages require other springboard packages as peers
   - Creates "install burden" on users who must explicitly install base + adapters
   - Example: Using tauri platform requires: springboard + @springboardjs/platforms-browser + @springboardjs/platforms-node + @springboardjs/platforms-tauri

3. **Import Paths**:
   - Users need to know: `springboard`, `springboard-server`, `springboard-cli`, `@springboardjs/platform-*`, etc.
   - No clear convention or documentation for "which package for what use case"

4. **Tree-shaking Limitations**:
   - Separate packages allow better tree-shaking IF unused
   - Current dependency structure doesn't guarantee tree-shaking works
   - Bundled approach with entry points could be similar or better

5. **Development Friction**:
   - Must maintain 14 separate package.json files
   - Publishing 14+ packages requires sequence coordination
   - Breaking changes require coordinating across multiple packages

---

## Part 2: Reference Framework Patterns

### 2.1 Nitro.js Structure (Server Framework)

Nitro.js consolidates into a single package with optional features:

```
nitro (main package)
├── core runtime
├── built-in presets (node, deno, cloudflare, vercel, etc.)
└── optional integrations (auth, database, cache, etc.)
```

**Key features:**
- Single package: `nitro`
- Presets installed separately OR via entry points
- Preset selection: `export { default } from './presets/node'`
- Optional integrations via peer dependencies
- Tree-shaking via conditional exports in `package.json` exports field

**package.json pattern:**
```json
{
  "exports": {
    ".": "./dist/index.js",
    "./presets/*": "./dist/presets/*",
    "./integrations/*": "./dist/integrations/*"
  }
}
```

### 2.2 h3 (HTTP Framework)

Minimal HTTP utility library with adapters:

**Approach:**
- Core package: `h3`
- Adapters are separate BUT maintained in same monorepo
- Single export for core, service-based adapters

**Benefits:**
- Clear separation of concerns
- Users import: `import { createServer } from 'h3'`
- Adapters: specific imports from subpaths

### 2.3 Hono (Multi-platform framework)

Hono supports multiple runtimes:

**Structure:**
- Core: `hono` package
- Adapters: built into core, selected via exports
- Pattern: `import { Hono } from 'hono'` then use context helpers

**Key insight:**
- All adapters in single package
- Tree-shaking via `dist/adapters/*` structure
- Entry points in exports field

**package.json exports:**
```json
{
  "exports": {
    ".": "./dist/index.js",
    "./adapters/*": "./dist/adapters/*",
    "./types": "./dist/types/index.js"
  },
  "typesVersions": {
    "*": {
      "adapters/*": ["./dist/adapters/*.d.ts"]
    }
  }
}
```

### 2.4 Proposed Pattern for Springboard

Combine insights from Nitro + Hono:

```json
{
  "name": "springboard",
  "exports": {
    ".": "./dist/core/index.js",
    "./server": "./dist/server/index.js",
    "./platforms/*": "./dist/platforms/*.js",
    "./plugins/*": "./dist/plugins/*.js",
    "./integrations/*": "./dist/integrations/*.js"
  },
  "peerDependencies": {
    "react": "optional",
    "react-dom": "optional",
    "react-router": "optional",
    "ws": "optional",
    "hono": "optional",
    "svelte": "optional"
  }
}
```

---

## Part 3: Proposed New Structure

### 3.1 Single Package Architecture

**New package name:** `springboard` (consolidate all under this)

**Directory structure:**
```
packages/springboard/
├── core/                    # Current core package code
├── server/                  # Current server code
├── platforms/
│   ├── node/               # Current platforms/node
│   ├── browser/            # Current platforms/webapp
│   ├── tauri/              # Current platforms/tauri
│   ├── partykit/           # Current platforms/partykit
│   └── react-native/       # Current platforms/react-native
├── plugins/
│   └── svelte/             # Current plugins/svelte
├── integrations/           # Renamed from 'external'
│   ├── mantine/
│   └── shoelace/
├── tools/                  # Renamed 'cli' subpackage
│   ├── cli/                # Current springboard-cli
│   └── create-app/         # Current create-springboard-app
├── data-storage/           # Current data_storage (or move to separate micro-package)
└── src/
    ├── index.ts            # Main entry
    ├── server/index.ts     # Server sub-entry
    ├── platforms/index.ts  # Platforms export
    ├── plugins/index.ts    # Plugins export
    └── integrations/index.ts
```

### 3.2 Entry Points (package.json exports)

```json
{
  "name": "springboard",
  "version": "0.16.0",
  "type": "module",
  "main": "./dist/index.js",
  "module": "./dist/index.js",
  "types": "./dist/index.d.ts",
  "exports": {
    ".": {
      "types": "./dist/index.d.ts",
      "import": "./dist/index.js",
      "require": "./dist/index.cjs"
    },
    "./server": {
      "types": "./dist/server/index.d.ts",
      "import": "./dist/server/index.js"
    },
    "./platforms/node": {
      "types": "./dist/platforms/node/index.d.ts",
      "import": "./dist/platforms/node/index.js"
    },
    "./platforms/browser": {
      "types": "./dist/platforms/browser/index.d.ts",
      "import": "./dist/platforms/browser/index.js"
    },
    "./platforms/tauri": {
      "types": "./dist/platforms/tauri/index.d.ts",
      "import": "./dist/platforms/tauri/index.js"
    },
    "./platforms/partykit": {
      "types": "./dist/platforms/partykit/index.d.ts",
      "import": "./dist/platforms/partykit/index.js"
    },
    "./platforms/react-native": {
      "types": "./dist/platforms/react-native/index.d.ts",
      "import": "./dist/platforms/react-native/index.js"
    },
    "./plugins/svelte": {
      "types": "./dist/plugins/svelte/index.d.ts",
      "import": "./dist/plugins/svelte/index.js"
    },
    "./integrations/mantine": {
      "types": "./dist/integrations/mantine/index.d.ts",
      "import": "./dist/integrations/mantine/index.js"
    },
    "./integrations/shoelace": {
      "types": "./dist/integrations/shoelace/index.d.ts",
      "import": "./dist/integrations/shoelace/index.js"
    }
  },
  "peerDependencies": {
    "react": "^16.0.0 || ^17.0.0 || ^18.0.0 || ^19.0.0",
    "react-dom": "^16.0.0 || ^17.0.0 || ^18.0.0 || ^19.0.0",
    "react-router": "^7",
    "rxjs": "^7.0.0",
    "immer": "^10.0.0",
    "ws": "^8.0.0",
    "isomorphic-ws": "^4.0.0",
    "hono": "^4.0.0",
    "svelte": ">=5",
    "@mantine/core": "^7.0.0",
    "@mantine/dropzone": "^7.0.0",
    "@mantine/hooks": "^7.0.0",
    "@mantine/modals": "^7.0.0",
    "@mantine/notifications": "^7.0.0",
    "@tauri-apps/api": "^2.0.0",
    "@tauri-apps/plugin-shell": "^2.0.0",
    "@shoelace-style/shoelace": "^2.0.0",
    "kysely": ">=0.24.0"
  },
  "peerDependenciesMeta": {
    "react": { "optional": true },
    "react-dom": { "optional": true },
    "react-router": { "optional": true },
    "rxjs": { "optional": true },
    "immer": { "optional": true },
    "ws": { "optional": true },
    "isomorphic-ws": { "optional": true },
    "hono": { "optional": true },
    "svelte": { "optional": true },
    "@mantine/core": { "optional": true },
    "@mantine/dropzone": { "optional": true },
    "@mantine/hooks": { "optional": true },
    "@mantine/modals": { "optional": true },
    "@mantine/notifications": { "optional": true },
    "@tauri-apps/api": { "optional": true },
    "@tauri-apps/plugin-shell": { "optional": true },
    "@shoelace-style/shoelace": { "optional": true },
    "kysely": { "optional": true }
  },
  "dependencies": {
    "dexie": "^4.2.1",
    "reconnecting-websocket": "^4.4.0",
    "json-rpc-2.0": "^1.7.1",
    "@hono/node-server": "^1.19.6",
    "@hono/node-ws": "^1.2.0",
    "better-sqlite3": "^12.4.1",
    "zod": "^3.25.7",
    "partysocket": "^1.1.6",
    "esbuild-svelte": "^0.9.3",
    "svelte-preprocess": "^6.0.3"
  }
}
```

### 3.3 Decision: Keep data-storage Separate?

**Two options:**

**Option A: Include data-storage in main package**
- Pros: Single package install, simpler
- Cons: Adds better-sqlite3 dependency to all installations

**Option B: Keep data-storage separate** (recommended)
- Pros: Users only install if needed
- Cons: One additional package to maintain

**Recommendation:** Keep separate as `@springboardjs/data-storage`

### 3.4 CLI Tools Packaging

**Current:** Two separate CLI packages
- `springboard-cli` (build tool)
- `create-springboard-app` (scaffolding)

**Option A: Include in main package**
- Entry: `springboard/tools/cli`
- Entry: `springboard/tools/create-app`
- Users run: `npx springboard build` (requires package.json bin)

**Option B: Keep separate CLI packages** (recommended)
- `springboard-cli` (build/dev tool)
- `create-springboard-app` (project generator)
- Rationale: CLI tools are heavy (esbuild, typescript) and not needed by library consumers

**Recommendation:** Keep CLI tools separate but export entry points from main package for discoverability

---

## Part 4: Migration Strategy

### 4.1 Phase 1: Consolidation (No Breaking Changes to Users)

**Step 1: Restructure files** (internal only)
```bash
# Move directories but maintain exports
mv packages/springboard/server/* packages/springboard/server/
mv packages/springboard/platforms/* packages/springboard/platforms/
mv packages/springboard/plugins/* packages/springboard/plugins/
mv packages/springboard/external packages/springboard/integrations/
# etc.
```

**Step 2: Update root package.json**
- Create main `packages/springboard/package.json` with all exports
- Keep individual package.json files in subdirectories for now (optional)

**Step 3: Create entry point files**
```typescript
// packages/springboard/src/index.ts
export { default as springboard } from '../core/src/index.js';
export * from '../core/src/engine/engine.js';

// packages/springboard/src/server/index.ts
export { default } from '../../server/src/register.js';

// packages/springboard/src/platforms/index.ts
export * from '../../platforms/node/services/index.js';
export * from '../../platforms/browser/services/index.js';
// etc.
```

**Step 4: Update pnpm-workspace.yaml**
```yaml
packages:
  - "apps/jamtools"
  - "apps/small_apps"
  - "packages/jamtools/core"
  - "packages/jamtools/features"
  - "packages/springboard"  # Single package instead of many
  - "packages/observability"
  - "packages/*"
```

**Step 5: Backward compatibility layer** (v1)
Keep old package names as redirect exports:
```json
{
  "exports": {
    ".": "./dist/index.js",
    "./server": "./dist/server/index.js"
  }
}
```

For old imports, support:
```typescript
// OLD: import springboard from 'springboard'
// NEW: import springboard from 'springboard'
// (same - no change)

// OLD: import server from 'springboard-server'
// NEW: import server from 'springboard/server'
// Support both: create dist/springboard-server.js that exports from ./server/index.js
```

### 4.2 Phase 2: Users Update Imports (v1.0.0 Beta)

**Migration guide for users:**

Old imports → New imports:
```typescript
// Core (no change)
import springboard from 'springboard';
import springboard from 'springboard'; // still works

// Server
import server from 'springboard-server';    // OLD
import server from 'springboard/server';    // NEW (preferred)

// Platforms
import { ... } from '@springboardjs/platforms-node';
import { ... } from 'springboard/platforms/node'; // NEW

// Plugins
import { ... } from '@springboardjs/plugin-svelte';
import { ... } from 'springboard/plugins/svelte'; // NEW

// Integrations
import { ... } from '@springboardjs/mantine';
import { ... } from 'springboard/integrations/mantine'; // NEW

// CLI (no change - separate packages)
npx springboard-cli build ...
npx create-springboard-app
```

**Codemods provided:**
```bash
npx @springboardjs/codemod-v1-migration
```

### 4.3 Phase 3: Cleanup (v2.0.0)

**Remove deprecated packages and aliases:**
- Remove: `springboard-server` package (use `springboard/server`)
- Remove: `@springboardjs/platforms-*` aliases (use `springboard/platforms/*`)
- Remove: `@springboardjs/plugin-*` aliases (use `springboard/plugins/*`)
- Remove: `@springboardjs/*` scoped integrations (use `springboard/integrations/*`)

**Keep separate:**
- `@springboardjs/data-storage` (allows independent updates if needed)
- `springboard-cli` (heavy CLI tool)
- `create-springboard-app` (scaffolding)

### 4.4 Timeline

```
Current (v0.15.0-rc)
├─ v0.16.0-alpha: Restructure with dual exports (old + new)
├─ v0.17.0-beta: Release with both paths working
├─ v1.0.0: Mark old packages as deprecated, encourage migration
├─ v1.1.0: Codemod tooling for auto-migration
└─ v2.0.0: Remove old packages (breaking change)
```

---

## Part 5: Breaking Changes Analysis

### 5.1 For Library Users

**Low impact** if migration provided smoothly:

1. Import path changes (handled by codemods)
   ```typescript
   // Update from '@springboardjs/platforms-node' → 'springboard/platforms/node'
   ```

2. Package installations
   ```bash
   # Before: npm install springboard springboard-server @springboardjs/platforms-node
   # After:  npm install springboard
   ```

3. TypeScript paths (if using path aliases)
   ```json
   // Update baseUrl configuration if using absolute imports
   ```

### 5.2 For Internal Development

**Moderate impact:**

1. Build system may need updates (Turbo configuration)
2. Testing paths change
3. Import paths in internal code
4. Publishing script changes

### 5.3 For CLI Tools

**No breaking changes:**
- CLI tools remain separate
- Same entry points and usage
- Possibly better: can cache/version independently

---

## Part 6: Tree-Shaking Considerations

### 6.1 Current vs. Proposed Approach

**Current (separate packages):**
```
User app
├── springboard (50KB)
├── springboard-server (15KB)
└── @springboardjs/platforms-node (10KB)
Total: 75KB (all bundled even if unused)
```

**Issue:** Even if user only uses core, importing `platforms-node` forces all code to bundle.

**Proposed (single package with subpaths):**
```json
{
  "exports": {
    ".": "./dist/core/index.js",
    "./server": "./dist/server/index.js",
    "./platforms/node": "./dist/platforms/node/index.js"
  }
}
```

**With proper tree-shaking:**
```
User app
├── springboard/core (50KB)
├── springboard/server (15KB)      // Only if imported
└── springboard/platforms/node (10KB) // Only if imported
```

### 6.2 Enabling Tree-Shaking

**package.json field:**
```json
{
  "sideEffects": [
    "./dist/core/register.js",
    "./dist/core/hooks/index.js"
  ]
}
```

**Build configuration:**
```typescript
// vite.config.ts
export default {
  build: {
    rollupOptions: {
      output: {
        preserveModules: true // Keep module structure
      }
    }
  }
}
```

**tsconfig settings:**
```json
{
  "compilerOptions": {
    "module": "ESNext",
    "moduleResolution": "node",
    "target": "ES2020"
  }
}
```

### 6.3 Testing Tree-shaking

Commands to verify:
```bash
# Analyze bundle size
npm run build -- --analyze

# Use source-map-explorer
npx source-map-explorer 'dist/index.js'

# Check for unused imports
npx unused-exports
```

### 6.4 Measurement Strategy

Create test bundles for common patterns:
```typescript
// test-bundles/core-only.ts
import springboard from 'springboard';

// test-bundles/with-server.ts
import springboard from 'springboard';
import server from 'springboard/server';

// test-bundles/with-platform.ts
import springboard from 'springboard';
import { ... } from 'springboard/platforms/node';
```

Measure each:
```bash
esbuild test-bundles/core-only.ts --bundle --minify --analyze
esbuild test-bundles/with-server.ts --bundle --minify --analyze
```

---

## Part 7: Dependencies Classification

### 7.1 Core Dependencies (Always Included)

These are required by springboard core:
```json
{
  "dependencies": {
    "dexie": "^4.2.1",
    "reconnecting-websocket": "^4.4.0",
    "json-rpc-2.0": "^1.7.1"
  }
}
```

### 7.2 Optional Peer Dependencies by Feature

**For server functionality:**
```json
{
  "peerDependencies": {
    "hono": "^4.6.0",
    "@hono/node-server": "^1.19.0",
    "@hono/node-ws": "^1.2.0"
  },
  "peerDependenciesMeta": {
    "hono": { "optional": true },
    "@hono/node-server": { "optional": true },
    "@hono/node-ws": { "optional": true }
  }
}
```

**For React/Browser:**
```json
{
  "peerDependencies": {
    "react": "^16.0.0 || ^17.0.0 || ^18.0.0 || ^19.0.0",
    "react-dom": "^16.0.0 || ^17.0.0 || ^18.0.0 || ^19.0.0",
    "react-router": "^7"
  },
  "peerDependenciesMeta": {
    "react": { "optional": true },
    "react-dom": { "optional": true },
    "react-router": { "optional": true }
  }
}
```

**For state management:**
```json
{
  "peerDependencies": {
    "rxjs": "^7.0.0",
    "immer": "^10.0.0"
  },
  "peerDependenciesMeta": {
    "rxjs": { "optional": true },
    "immer": { "optional": true }
  }
}
```

**For Node/WebSocket:**
```json
{
  "peerDependencies": {
    "ws": "^8.0.0",
    "isomorphic-ws": "^4.0.0"
  },
  "peerDependenciesMeta": {
    "ws": { "optional": true },
    "isomorphic-ws": { "optional": true }
  }
}
```

**For Desktop (Tauri):**
```json
{
  "peerDependencies": {
    "@tauri-apps/api": "^2.0.0",
    "@tauri-apps/plugin-shell": "^2.0.0"
  },
  "peerDependenciesMeta": {
    "@tauri-apps/api": { "optional": true },
    "@tauri-apps/plugin-shell": { "optional": true }
  }
}
```

**For Database/Storage:**
```json
{
  "peerDependencies": {
    "kysely": ">=0.24.0",
    "better-sqlite3": "^12.0.0"
  },
  "peerDependenciesMeta": {
    "kysely": { "optional": true },
    "better-sqlite3": { "optional": true }
  }
}
```

**For Svelte Plugin:**
```json
{
  "peerDependencies": {
    "svelte": ">=5"
  },
  "peerDependenciesMeta": {
    "svelte": { "optional": true }
  }
}
```

**For UI Integrations:**
```json
{
  "peerDependencies": {
    "@mantine/core": "^7.0.0",
    "@mantine/dropzone": "^7.0.0",
    "@mantine/hooks": "^7.0.0",
    "@mantine/modals": "^7.0.0",
    "@mantine/notifications": "^7.0.0",
    "@shoelace-style/shoelace": "^2.0.0"
  },
  "peerDependenciesMeta": {
    "@mantine/core": { "optional": true },
    "@mantine/dropzone": { "optional": true },
    "@mantine/hooks": { "optional": true },
    "@mantine/modals": { "optional": true },
    "@mantine/notifications": { "optional": true },
    "@shoelace-style/shoelace": { "optional": true }
  }
}
```

### 7.3 Installation Examples

**Minimal (core only):**
```bash
npm install springboard
```

**Browser app:**
```bash
npm install springboard react react-dom react-router
```

**Server + Hono:**
```bash
npm install springboard hono @hono/node-server @hono/node-ws
```

**Full Tauri app:**
```bash
npm install springboard react react-dom \
  @tauri-apps/api @tauri-apps/plugin-shell
```

**With Svelte:**
```bash
npm install springboard svelte
```

---

## Part 8: Package.json Export Examples

### 8.1 Full New package.json

```json
{
  "name": "springboard",
  "version": "1.0.0",
  "description": "Full-stack JavaScript framework",
  "type": "module",
  "main": "./dist/index.js",
  "module": "./dist/index.js",
  "types": "./dist/index.d.ts",
  "bin": {
    "springboard": "./dist/cli/springboard.js"
  },
  "files": [
    "dist",
    "src",
    "core",
    "server",
    "platforms",
    "plugins",
    "integrations",
    "data-storage"
  ],
  "exports": {
    ".": {
      "types": "./dist/index.d.ts",
      "import": "./dist/index.js"
    },
    "./server": {
      "types": "./dist/server/index.d.ts",
      "import": "./dist/server/index.js"
    },
    "./platforms/node": {
      "types": "./dist/platforms/node/index.d.ts",
      "import": "./dist/platforms/node/index.js"
    },
    "./platforms/browser": {
      "types": "./dist/platforms/browser/index.d.ts",
      "import": "./dist/platforms/browser/index.js"
    },
    "./platforms/tauri": {
      "types": "./dist/platforms/tauri/index.d.ts",
      "import": "./dist/platforms/tauri/index.js"
    },
    "./platforms/partykit": {
      "types": "./dist/platforms/partykit/index.d.ts",
      "import": "./dist/platforms/partykit/index.js"
    },
    "./platforms/react-native": {
      "types": "./dist/platforms/react-native/index.d.ts",
      "import": "./dist/platforms/react-native/index.js"
    },
    "./plugins/svelte": {
      "types": "./dist/plugins/svelte/index.d.ts",
      "import": "./dist/plugins/svelte/index.js"
    },
    "./integrations/mantine": {
      "types": "./dist/integrations/mantine/index.d.ts",
      "import": "./dist/integrations/mantine/index.js"
    },
    "./integrations/shoelace": {
      "types": "./dist/integrations/shoelace/index.d.ts",
      "import": "./dist/integrations/shoelace/index.js"
    },
    "./package.json": "./package.json"
  },
  "typesVersions": {
    "*": {
      "server": ["./dist/server/index.d.ts"],
      "platforms/*": ["./dist/platforms/*/index.d.ts"],
      "plugins/*": ["./dist/plugins/*/index.d.ts"],
      "integrations/*": ["./dist/integrations/*/index.d.ts"]
    }
  },
  "sideEffects": false,
  "keywords": [
    "framework",
    "full-stack",
    "isomorphic",
    "real-time"
  ],
  "repository": {
    "type": "git",
    "url": "https://github.com/jamtools/springboard.git",
    "directory": "packages/springboard"
  },
  "bugs": {
    "url": "https://github.com/jamtools/springboard/issues"
  },
  "homepage": "https://springboard.js.org",
  "license": "ISC",
  "author": "JamTools",
  "scripts": {
    "test": "vitest --run",
    "test:watch": "vitest",
    "check-types": "tsc --noEmit",
    "lint": "eslint --ext ts --ext tsx ./",
    "fix": "npm run lint -- --fix",
    "build": "esbuild src/**/*.ts --outdir=dist --platform=node --target=es2020 --format=esm",
    "build:watch": "npm run build -- --watch"
  },
  "dependencies": {
    "dexie": "^4.2.1",
    "json-rpc-2.0": "^1.7.1",
    "reconnecting-websocket": "^4.4.0"
  },
  "optionalDependencies": {
    "@hono/node-server": "^1.19.6",
    "@hono/node-ws": "^1.2.0",
    "@mantine/core": "^7.13.4",
    "@mantine/dropzone": "^7.13.4",
    "@mantine/hooks": "^7.13.4",
    "@mantine/modals": "^7.13.4",
    "@mantine/notifications": "^7.13.4",
    "@shoelace-style/shoelace": "^2.20.1",
    "@tauri-apps/api": "^2.9.0",
    "@tauri-apps/plugin-shell": "^2.3.3",
    "better-sqlite3": "^12.4.1",
    "hono": "^4.6.17",
    "immer": "^10.1.1",
    "isomorphic-ws": "^4.0.1",
    "kysely": ">=0.24.0",
    "react": "^16.0.0 || ^17.0.0 || ^18.0.0 || ^19.0.0",
    "react-dom": "^16.0.0 || ^17.0.0 || ^18.0.0 || ^19.0.0",
    "react-router": "^7",
    "rxjs": "^7.8.1",
    "svelte": ">=5",
    "ws": "^8.18.3",
    "zod": "^3.25.7"
  },
  "peerDependencies": {
    "@hono/node-server": "^1.19.6",
    "@hono/node-ws": "^1.2.0",
    "@mantine/core": "^7.13.4",
    "@mantine/dropzone": "^7.13.4",
    "@mantine/hooks": "^7.13.4",
    "@mantine/modals": "^7.13.4",
    "@mantine/notifications": "^7.13.4",
    "@shoelace-style/shoelace": "^2.20.1",
    "@tauri-apps/api": "^2.9.0",
    "@tauri-apps/plugin-shell": "^2.3.3",
    "better-sqlite3": "^12.4.1",
    "hono": "^4.6.17",
    "immer": "^10.1.1",
    "isomorphic-ws": "^4.0.1",
    "kysely": ">=0.24.0",
    "react": "^16.0.0 || ^17.0.0 || ^18.0.0 || ^19.0.0",
    "react-dom": "^16.0.0 || ^17.0.0 || ^18.0.0 || ^19.0.0",
    "react-router": "^7",
    "rxjs": "^7.8.1",
    "svelte": ">=5",
    "ws": "^8.18.3",
    "zod": "^3.25.7"
  },
  "peerDependenciesMeta": {
    "@hono/node-server": { "optional": true },
    "@hono/node-ws": { "optional": true },
    "@mantine/core": { "optional": true },
    "@mantine/dropzone": { "optional": true },
    "@mantine/hooks": { "optional": true },
    "@mantine/modals": { "optional": true },
    "@mantine/notifications": { "optional": true },
    "@shoelace-style/shoelace": { "optional": true },
    "@tauri-apps/api": { "optional": true },
    "@tauri-apps/plugin-shell": { "optional": true },
    "better-sqlite3": { "optional": true },
    "hono": { "optional": true },
    "immer": { "optional": true },
    "isomorphic-ws": { "optional": true },
    "kysely": { "optional": true },
    "react": { "optional": true },
    "react-dom": { "optional": true },
    "react-router": { "optional": true },
    "rxjs": { "optional": true },
    "svelte": { "optional": true },
    "ws": { "optional": true },
    "zod": { "optional": true }
  },
  "devDependencies": {
    "@types/better-sqlite3": "^7.6.13",
    "@types/node": "^20.17.48",
    "@types/react": "^19.2.6",
    "@types/react-dom": "^19.2.3",
    "typescript": "^5.9.3",
    "vitest": "^2.1.9"
  },
  "config": {
    "dir": "../../configs"
  }
}
```

### 8.2 New Source File Structure

```
src/
├── index.ts                    # Main entry
│   export default springboard;
│   export * from '../core/src/index.js';
│
├── server/
│   └── index.ts               # Server sub-entry
│       export { default } from '../../server/src/register.js';
│
├── platforms/
│   ├── node/
│   │   └── index.ts
│   │       export * from '../../../platforms/node/services/index.js';
│   │
│   ├── browser/
│   │   └── index.ts
│   │       export * from '../../../platforms/webapp/services/index.js';
│   │
│   ├── tauri/
│   │   └── index.ts
│   │
│   ├── partykit/
│   │   └── index.ts
│   │
│   └── react-native/
│       └── index.ts
│
├── plugins/
│   └── svelte/
│       └── index.ts
│
└── integrations/
    ├── mantine/
    │   └── index.ts
    │
    └── shoelace/
        └── index.ts
```

---

## Part 9: Implementation Checklist

### Phase 1: Preparation (Week 1)
- [ ] Create this consolidation plan document
- [ ] Get stakeholder approval
- [ ] Create feature branch: `vk/consolidate-packages`
- [ ] Backup current publishing script

### Phase 2: Restructuring (Weeks 2-3)
- [ ] Create new directory structure under packages/springboard/src/
- [ ] Create main package.json with exports
- [ ] Create entry point files (index.ts for each export)
- [ ] Update tsconfig.json references
- [ ] Update imports in subdirectories to work with new structure
- [ ] Update pnpm-workspace.yaml
- [ ] Test builds for each export path

### Phase 3: Build & Bundling (Week 4)
- [ ] Update build scripts to handle multiple entry points
- [ ] Create dist/ output for each export path
- [ ] Generate .d.ts files for each export
- [ ] Test tree-shaking with example bundles
- [ ] Verify bundle sizes remain reasonable

### Phase 4: Testing (Week 5)
- [ ] Unit tests for all modules
- [ ] Integration tests for platform combinations
- [ ] End-to-end tests with example apps
- [ ] Test backward compatibility (old imports still work)
- [ ] Performance benchmarks

### Phase 5: Documentation (Week 6)
- [ ] Update README with new import paths
- [ ] Create migration guide
- [ ] Update API docs with new entry points
- [ ] Create codemod tool for auto-migration
- [ ] Update examples in repo

### Phase 6: Release (Week 7)
- [ ] Merge to main branch
- [ ] Create v0.16.0-alpha release
- [ ] Publish to npm with `@alpha` tag
- [ ] Gather feedback from early adopters
- [ ] Iterate on feedback

### Phase 7: Stabilization (Weeks 8-9)
- [ ] Fix issues from alpha testing
- [ ] Release v0.16.0-beta
- [ ] Release v0.17.0 stable with both old and new exports

### Phase 8: Cleanup (v2.0.0 later)
- [ ] Deprecate old package names
- [ ] Remove old packages
- [ ] Update all documentation
- [ ] Release v2.0.0

---

## Part 10: Risk Assessment & Mitigation

### Risk 1: Build System Complexity
**Risk:** Bundling 14 packages with multiple entry points may create complex build outputs
**Mitigation:**
- Test build process incrementally
- Use conditional exports in package.json
- Keep modular build structure (preserve modules)

### Risk 2: Tree-shaking Not Working
**Risk:** Single package might bundle all code even when only using core
**Mitigation:**
- Mark packages with `sideEffects: false`
- Test tree-shaking with common scenarios
- Provide analysis tools for bundle size

### Risk 3: Breaking Changes for Users
**Risk:** Import path changes could break existing code
**Mitigation:**
- Provide backward compatibility layer (v0.16-v1.x)
- Create codemod tool for auto-migration
- Clear migration guide with examples

### Risk 4: Publishing Complexity
**Risk:** Single package with multiple sub-versions might complicate publishing
**Mitigation:**
- Update publishing script to handle single package
- Verify all exports work before releasing
- Test release with dry-run first

### Risk 5: Documentation Lag
**Risk:** Users confused about which import to use
**Mitigation:**
- Clear documentation with examples for each use case
- TypeScript IntelliSense shows available exports
- Examples in repo show correct imports

---

## Part 11: Success Metrics

### Quantitative Metrics

1. **Package count reduction:**
   - Current: 14 packages
   - Target: 4-5 packages (springboard + data-storage + CLI tools)
   - Success: 70%+ reduction

2. **Installation simplification:**
   - Current: Users install 3-4 packages minimum
   - Target: Single package with optional dependencies
   - Success: `npm install springboard` works for 80%+ of use cases

3. **Bundle size:**
   - Current: Separate packages = duplication risk
   - Target: Single package with tree-shaking
   - Success: No increase in size for basic usage, 10-20% reduction for core

4. **Type checking performance:**
   - Target: Faster due to unified types
   - Success: < 2s type check time

### Qualitative Metrics

1. **Developer Experience:**
   - Users find imports more intuitive
   - IDE autocomplete more helpful
   - Migration guide rated helpful

2. **Maintenance:**
   - Single package.json easier to maintain
   - Publishing simpler and faster
   - Fewer version coordination issues

3. **Discoverability:**
   - New users understand available features better
   - Clear plugin/integration system apparent

---

## Part 12: Reference Implementations

### 12.1 Comparison Table

| Aspect | Current | Proposed | Nitro | Hono |
|--------|---------|----------|-------|------|
| Packages | 14+ | 4-5 | 1 | 1 |
| Entry points | Package-based | Path-based | Both | Both |
| Tree-shaking | Package-based | Module-based | Module | Module |
| Peer deps | Scattered | Centralized | Centralized | Centralized |
| Version sync | Manual | Automatic | Automatic | Automatic |
| User install | 3-4 packages | 1 package | 1 package | 1 package |

### 12.2 Similar Projects Already Done This

- **Vite**: Started multi-package, now consolidated
- **Astro**: Multiple packages but unified exports
- **Next.js**: Monolithic package with plugins
- **Nuxt**: Single package with modules/plugins
- **SvelteKit**: Single package with adapters
- **Nitro**: Single package with presets/integrations
- **Hono**: Single package with adapters/middleware

---

## Conclusion

Consolidating the 14+ Springboard packages into a single main package with optional peer dependencies would:

1. **Simplify user experience** - Single `npm install springboard` instead of 3-4 packages
2. **Reduce maintenance burden** - One package.json to update, simpler publishing
3. **Improve discoverability** - Clear entry points in exports field
4. **Enable better tree-shaking** - Module structure with clear separation
5. **Match industry standards** - Follows Nitro.js, Hono, Next.js patterns

The migration can be done gradually with full backward compatibility (v0.16-v1.x) before removing old packages in v2.0.

**Recommended next steps:**
1. Get stakeholder approval on this plan
2. Create feature branch for implementation
3. Start Phase 1 (Preparation)
4. Target release for next minor version (v0.16.0-alpha)

